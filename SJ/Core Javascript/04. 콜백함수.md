# 04. 콜백함수

### 콜백 함수란?

- 콜백함수는 다른 코드의 인자로 넘겨주는 함수

### 제어권

- 호출 시점
    - 콜백함수의 제어권을 넘겨받은 코드는 콜백함수 호출 시점에 대한 제어권을 가진다.
- 인자
    - 콜백 함수의 제어권을 넘겨받은 코드는 콜백 함수를 호출할 때 인자에 어떤 값들을 어떤 순서로 넘길 것인지에 대한 제어권을 가진다.
- this
    - 콜백 함수도 함수이기 때문에 기본적으로 this가 전역객체를 참조하지만, 제어권을 넘겨받을 코드에서 콜백함수에 별도로 this가 될 대상을 지정한 경우에는 그 대상을 참조하게 된다.
    (ex. .addEventListener 등)

### 콜백 함수는 함수다

메서드를 콜백 함수로 전달한 경우

```jsx
var obj = {
	vals: [1,2,3],
	logValues: function(v, i) {
		console.log(this, v, i);
	}
};
obj.logValues(1, 2); // {vals: [1,2,3[, logValues: f} 1 2
[4,5,6].forEach(obj.logValues); //Window {...} 4 0 Window{...} 5 1 Window{...} 6 2
```

- [4,5,6].forEach(obj.logValues); 에서 메서드를 forEach함수의 콜백 함수로서 전달했다. obj를 this로 하는 메서드를 그대로 전달한 것이 아니라 obj.logValues가 가리키는 함수만 전달한 것.
- forEach에 의해 콜백이 함수로서 호출되고, 별도로 this를 지정하는 인자를 지정하지 않았으므로 함수 내부 this는 전역객체를 바라보게 된다.

### 콜백 지옥과 비동기 제어

- 콜백지옥은 콜백 함수를 익명함수로 전달하는 과정이 반복되어 코드의 들여쓰기 수준이 감당하기 힘들 정도로 깊어지는 현상
- 동기적인 코드
    - CPU의 계산에 의해 즉시 처리가 가능한 대부분의 코드
- 비동기적인 코드
    - 별도의 요청, 실행대기, 보류 등과 관련된 코드
- 자바스크립트는 웹의 복잡도가 높아진 만큼 비동기적 코드 비중이 예전보다 훨씬 높아짐
    - ES6에서 Promise, Generator 등이 도입되었고, ES2017에서 async/await가 도입되었다.
    - 이를 이용해 콜백지옥을 줄일 수 있다.

### 정리

- 콜백 함수는 다른 코드에 인자로 넘겨줌으로써 그 제어권도 함께 위임한 함수
- 제어권을 넘겨받은 코드는 다음과 같은 제어권을 가진다.
    - 콜백 함수를 호출하는 시점을 스스로 판단해서 실행
    - 콜백함수를 호출할 때 인자로 넘겨줄 값들 및 그 순서가 정해져 있음. 이 순서를 따르지 않고 코드를 작성하면 엉뚱한 결과를 얻게된다.
    - 콜백 함수의 this가 무엇을 바라보도록 할지가 정해져 있는 경우도 있는데, 정하지 않은 경우에는 전역객체를 바라본다. 사용자 임의로 this를 바꾸고 싶을 경우 bind메서드를 활용하면 된다.
    - 어떤 함수에 인자로 메서드를 전달하더라도 이는 결국 함수로서 실행이된다.
    - 비동기 제어를 위해 콜백 함수를 사용하다 보면 콜백지옥에 빠지기 쉬운데 최근 ES에 Promise, Generator, async/await 등 콜백 지옥에서 벗어날 수 있는 훌륭한 방법들이 속속 등장하고 있다.